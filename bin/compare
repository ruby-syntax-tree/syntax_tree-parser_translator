#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"

$:.unshift(File.expand_path("../lib", __dir__))
require "syntax_tree/translator"
require "parser/current"

Parser::Builders::Default.emit_arg_inside_procarg0 = true
Parser::Builders::Default.emit_forward_arg = true
Parser::Builders::Default.emit_index = true
Parser::Builders::Default.emit_procarg0 = true

source = ARGF.read
visitor = SyntaxTree::Translator::Parser.new("(string)", 1)

stree = visitor.visit(SyntaxTree.parse(source))
parser = Parser::CurrentRuby.parse(source)

if stree == parser
  puts "Syntax trees are equivalent."
else
  warn "Syntax trees are different."

  warn "syntax_tree:"
  pp stree

  warn "parser:"
  pp parser
end
